
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18: http://docutils.sourceforge.net/" />

    <title>03. Prioritized Experience Replay (PER) &#8212; ZC Notebook</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/extra.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'reinforcement/per';</script>
    <link rel="shortcut icon" href="../_static/favicon.svg"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="04. Dueling Network" href="dueling.html" />
    <link rel="prev" title="02. Double DQN" href="double_q.html" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">  
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this site..." aria-label="Search this site..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fas fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image">
    <img src="../_static/logo-dark.png" class="logo__image only-dark" alt="Logo image">
  
  
    <p class="title logo__title">ZC's Notebook</p>
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        强化学习
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../science/index.html">
                        科学计算
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../blog.html">
                        博客
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../collection.html">
                        网页收藏
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../about.html">
                        关于本站
                    </a>
                </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
            <li class="nav-item">
                <a class="nav-link nav-external" href="https://course.rs/about-book.html">Rust语言圣经<i class="fas fa-external-link-alt"></i></a>
            </li>

            <li class="nav-item">
                <a class="nav-link nav-external" href="https://rust-book.junmajinlong.com/">Rust入门秘籍<i class="fas fa-external-link-alt"></i></a>
            </li>

            <li class="nav-item">
                <a class="nav-link nav-external" href="https://nomicon.purewhite.io/intro.html">Rust 秘典<i class="fas fa-external-link-alt"></i></a>
            </li>
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://github.com/zclab" title="GitHub" class="nav-link" rel="noopener" target="_blank"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fas fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        强化学习
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../science/index.html">
                        科学计算
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../blog.html">
                        博客
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../collection.html">
                        网页收藏
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../about.html">
                        关于本站
                    </a>
                </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
            <li class="nav-item">
                <a class="nav-link nav-external" href="https://course.rs/about-book.html">Rust语言圣经<i class="fas fa-external-link-alt"></i></a>
            </li>

            <li class="nav-item">
                <a class="nav-link nav-external" href="https://rust-book.junmajinlong.com/">Rust入门秘籍<i class="fas fa-external-link-alt"></i></a>
            </li>

            <li class="nav-item">
                <a class="nav-link nav-external" href="https://nomicon.purewhite.io/intro.html">Rust 秘典<i class="fas fa-external-link-alt"></i></a>
            </li>
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://github.com/zclab" title="GitHub" class="nav-link" rel="noopener" target="_blank"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="A2C.html">
   Actor-Critic
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="PPO.html">
   Proximal Policy Optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DDPG.html">
   Deep Deterministic Policy Gradient
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="TD3.html">
   TD3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SAC.html">
   Soft Actor Critic (SAC)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DDPGfD.html">
   DDPGfD
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BC.html">
   Behavior Cloning (without HER)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dqn.html">
   Deep Q Network (DQN)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="double_q.html">
   Double DQN
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Prioritized Experience Replay (PER)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dueling.html">
   Dueling Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="noisy_net.html">
   Noisy Networks for Exploration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="categorical_dqn.html">
   Categorical DQN
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="n_step_learning.html">
   N-Step Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rainbow.html">
   Rainbow
  </a>
 </li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
<div class="bd-content">
    <div class="bd-article-container">
        
        <div class="bd-header-article">
            
        </div>
        
        
        <article class="bd-article" role="main">
             <section class="tex2jax_ignore mathjax_ignore" id="prioritized-experience-replay-per">
<h1>03. Prioritized Experience Replay (PER)<a class="headerlink" href="#prioritized-experience-replay-per" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="https://arxiv.org/pdf/1511.05952.pdf">T. Schaul et al., “Prioritized Experience Replay.” arXiv preprint arXiv:1511.05952, 2015.</a></p>
<p>Using a replay memory leads to design choices at two levels: which experiences to store, and which experiences to replay (and how to do so). This paper addresses only the latter: making the most effective use of the replay memory for learning, assuming that its contents are outside of our control.</p>
<p>The central component of prioritized replay is the criterion by which the importance of each transition is measured. A reasonable approach is to use the magnitude of a transition’s TD error <span class="math notranslate nohighlight">\(\delta\)</span>, which indicates how ‘surprising’
or unexpected the transition is. This algorithm stores the last encountered TD error along with each transition in the replay memory. The transition with the largest absolute TD error is replayed from the memory. A Q-learning update
is applied to this transition, which updates the weights in proportion to the TD error. One thing to note that new transitions arrive without a known TD-error, so it puts them at maximal priority in order to guarantee that all experience is seen at least once. (see <em>store</em> method)</p>
<p>We might use 2 ideas to deal with TD-error: 1. greedy TD-error prioritization, 2. stochastic prioritization. However, greedy TD-error prioritization has a severe drawback. Greedy prioritization focuses on a small subset of the experience: errors shrink slowly, especially when using function approximation, meaning that the initially high error transitions get replayed frequently. This lack of diversity that makes the system prone to over-fitting. To overcome this issue, we will use a stochastic sampling method that interpolates between pure greedy prioritization and uniform random sampling.</p>
<div class="math notranslate nohighlight">
\[
P(i) = \frac{p_i^{\alpha}}{\sum_k p_k^{\alpha}}
\]</div>
<p>where <span class="math notranslate nohighlight">\(p_i &gt; 0\)</span> is the priority of transition <span class="math notranslate nohighlight">\(i\)</span>. The exponent <span class="math notranslate nohighlight">\(\alpha\)</span> determines how much prioritization is used, with <span class="math notranslate nohighlight">\(\alpha = 0\)</span> corresponding to the uniform case. In practice, we use additional term <span class="math notranslate nohighlight">\(\epsilon\)</span> in order to guarantee all transactions can be possibly sampled: <span class="math notranslate nohighlight">\(p_i = |\delta_i| + \epsilon\)</span>, where <span class="math notranslate nohighlight">\(\epsilon\)</span> is a small positive constant.</p>
<p>One more. Let’s recall one of the main ideas of DQN. To remove correlation of observations, it uses uniformly random sampling from the replay buffer. Prioritized replay introduces bias because it doesn’t sample experiences uniformly at random due to the sampling proportion correspoding to TD-error. We can correct this bias by using importance-sampling (IS) weights</p>
<div class="math notranslate nohighlight">
\[
w_i = \big( \frac{1}{N} \cdot \frac{1}{P(i)} \big)^\beta
\]</div>
<p>that fully compensates for the non-uniform probabilities <span class="math notranslate nohighlight">\(P(i)\)</span> if <span class="math notranslate nohighlight">\(\beta = 1\)</span>. These weights can be folded into the Q-learning update by using <span class="math notranslate nohighlight">\(w_i\delta_i\)</span> instead of <span class="math notranslate nohighlight">\(\delta_i\)</span>. In typical reinforcement learning scenarios, the unbiased nature of the updates is most important near convergence at the end of training, We therefore exploit the flexibility of annealing the amount of importance-sampling correction over time, by defining a schedule on the exponent <span class="math notranslate nohighlight">\(\beta\)</span> that reaches 1 only at the end of learning.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">gym</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>

<span class="k">if</span> <span class="n">IN_COLAB</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;segment_tree.py&quot;</span><span class="p">):</span>
    <span class="c1"># download segment tree module</span>
    <span class="o">!</span>wget https://raw.githubusercontent.com/curt-park/rainbow-is-all-you-need/master/segment_tree.py
        
<span class="kn">from</span> <span class="nn">segment_tree</span> <span class="kn">import</span> <span class="n">MinSegmentTree</span><span class="p">,</span> <span class="n">SumSegmentTree</span>
</pre></div>
</div>
</div>
</div>
<section id="replay-buffer">
<h2>Replay buffer<a class="headerlink" href="#replay-buffer" title="Permalink to this heading">#</a></h2>
<p>Please see <em>01.dqn.ipynb</em> for detailed description.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ReplayBuffer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A simple numpy replay buffer.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_buf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">size</span><span class="p">,</span> <span class="n">obs_dim</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_obs_buf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">size</span><span class="p">,</span> <span class="n">obs_dim</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acts_buf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">size</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rews_buf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">size</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done_buf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ptr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">store</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">obs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">act</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
        <span class="n">rew</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
        <span class="n">next_obs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
        <span class="n">done</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obs_buf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ptr</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_obs_buf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ptr</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_obs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acts_buf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ptr</span><span class="p">]</span> <span class="o">=</span> <span class="n">act</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rews_buf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ptr</span><span class="p">]</span> <span class="o">=</span> <span class="n">rew</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done_buf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ptr</span><span class="p">]</span> <span class="o">=</span> <span class="n">done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ptr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ptr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sample_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obs_buf</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span>
                    <span class="n">next_obs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">next_obs_buf</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span>
                    <span class="n">acts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">acts_buf</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span>
                    <span class="n">rews</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rews_buf</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span>
                    <span class="n">done</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">done_buf</span><span class="p">[</span><span class="n">idxs</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="prioritized-replay-buffer">
<h2>Prioritized replay Buffer<a class="headerlink" href="#prioritized-replay-buffer" title="Permalink to this heading">#</a></h2>
<p>The key concept of PER’s implementation is <em>Segment Tree</em>. It efficiently stores and samples transitions while managing the priorities of them. We recommend you understand how it works before you move on. Here are references for you:</p>
<ul class="simple">
<li><p>In Korean: https://mrsyee.github.io/rl/2019/01/25/PER-sumtree/</p></li>
<li><p>In English: https://www.geeksforgeeks.org/segment-tree-set-1-sum-of-given-range/</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PrioritizedReplayBuffer</span><span class="p">(</span><span class="n">ReplayBuffer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prioritized Replay buffer.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        max_priority (float): max priority</span>
<span class="sd">        tree_ptr (int): next index of tree</span>
<span class="sd">        alpha (float): alpha parameter for prioritized replay buffer</span>
<span class="sd">        sum_tree (SumSegmentTree): sum tree for prior</span>
<span class="sd">        min_tree (MinSegmentTree): min tree for min prior to get max weight</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">obs_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> 
        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">alpha</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        
        <span class="nb">super</span><span class="p">(</span><span class="n">PrioritizedReplayBuffer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">obs_dim</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_priority</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        
        <span class="c1"># capacity must be positive and a power of 2.</span>
        <span class="n">tree_capacity</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">tree_capacity</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">:</span>
            <span class="n">tree_capacity</span> <span class="o">*=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sum_tree</span> <span class="o">=</span> <span class="n">SumSegmentTree</span><span class="p">(</span><span class="n">tree_capacity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_tree</span> <span class="o">=</span> <span class="n">MinSegmentTree</span><span class="p">(</span><span class="n">tree_capacity</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">store</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">obs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
        <span class="n">act</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
        <span class="n">rew</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
        <span class="n">next_obs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
        <span class="n">done</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store experience and priority.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">act</span><span class="p">,</span> <span class="n">rew</span><span class="p">,</span> <span class="n">next_obs</span><span class="p">,</span> <span class="n">done</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sum_tree</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_priority</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_tree</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_priority</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span>

    <span class="k">def</span> <span class="nf">sample_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Sample a batch of experiences.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span>
        <span class="k">assert</span> <span class="n">beta</span> <span class="o">&gt;</span> <span class="mi">0</span>
        
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_proportional</span><span class="p">()</span>
        
        <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obs_buf</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">next_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_obs_buf</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acts_buf</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">rews</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rews_buf</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">done_buf</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_calculate_weight</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">obs</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span>
            <span class="n">next_obs</span><span class="o">=</span><span class="n">next_obs</span><span class="p">,</span>
            <span class="n">acts</span><span class="o">=</span><span class="n">acts</span><span class="p">,</span>
            <span class="n">rews</span><span class="o">=</span><span class="n">rews</span><span class="p">,</span>
            <span class="n">done</span><span class="o">=</span><span class="n">done</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
            <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
        <span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">update_priorities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">priorities</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update priorities of sampled transitions.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">priorities</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">priority</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">priorities</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">priority</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sum_tree</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">priority</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_tree</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">priority</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">max_priority</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_priority</span><span class="p">,</span> <span class="n">priority</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">_sample_proportional</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Sample indices based on proportions.&quot;&quot;&quot;</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_tree</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="n">p_total</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">segment</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">segment</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">upperbound</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_tree</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">upperbound</span><span class="p">)</span>
            <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">indices</span>
    
    <span class="k">def</span> <span class="nf">_calculate_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the weight of the experience at idx.&quot;&quot;&quot;</span>
        <span class="c1"># get max weight</span>
        <span class="n">p_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_tree</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_tree</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">max_weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_min</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="p">)</span>
        
        <span class="c1"># calculate weights</span>
        <span class="n">p_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_tree</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_tree</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_sample</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">max_weight</span>
        
        <span class="k">return</span> <span class="n">weight</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="network">
<h2>Network<a class="headerlink" href="#network" title="Permalink to this heading">#</a></h2>
<p>We are going to use a simple network architecture with three fully connected layers and two non-linearity functions (ReLU).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Network</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">out_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Network</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_dim</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> 
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> 
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span> 
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">out_dim</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Forward method implementation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dqn-per-agent">
<h2>DQN + PER Agent<a class="headerlink" href="#dqn-per-agent" title="Permalink to this heading">#</a></h2>
<p>Here is a summary of DQNAgent class.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>select_action</p></td>
<td><p>select an action from the input state.</p></td>
</tr>
<tr class="row-odd"><td><p>step</p></td>
<td><p>take an action and return the response of the env.</p></td>
</tr>
<tr class="row-even"><td><p>compute_dqn_loss</p></td>
<td><p>return dqn loss.</p></td>
</tr>
<tr class="row-odd"><td><p>update_model</p></td>
<td><p>update the model by gradient descent.</p></td>
</tr>
<tr class="row-even"><td><p>target_hard_update</p></td>
<td><p>hard update from the local model to the target model.</p></td>
</tr>
<tr class="row-odd"><td><p>train</p></td>
<td><p>train the agent during num_frames.</p></td>
</tr>
<tr class="row-even"><td><p>test</p></td>
<td><p>test the agent (1 episode).</p></td>
</tr>
<tr class="row-odd"><td><p>plot</p></td>
<td><p>plot the training progresses.</p></td>
</tr>
</tbody>
</table>
<p>All differences from pure DQN are noted with comments - PER.</p>
<section id="init">
<h3><strong>init</strong><a class="headerlink" href="#init" title="Permalink to this heading">#</a></h3>
<p>Here, we use PrioritizedReplayBuffer, instead of ReplayBuffer, and use hold 2 more parameters beta and priority epsilon which are used to calculate weights and new priorities respectively.</p>
</section>
<section id="compute-dqn-loss-update-model">
<h3>compute_dqn_loss &amp; update_model<a class="headerlink" href="#compute-dqn-loss-update-model" title="Permalink to this heading">#</a></h3>
<p>It returns every loss per each sample for importance sampling before average. After updating the nework, it is necessary to update priorities of all sampled experiences.</p>
</section>
<section id="train">
<h3>train<a class="headerlink" href="#train" title="Permalink to this heading">#</a></h3>
<p>beta linearly increases to 1 at every training step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DQNAgent</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;DQN Agent interacting with environment.</span>
<span class="sd">    </span>
<span class="sd">    Attribute:</span>
<span class="sd">        env (gym.Env): openAI Gym environment</span>
<span class="sd">        memory (ReplayBuffer): replay memory to store transitions</span>
<span class="sd">        batch_size (int): batch size for sampling</span>
<span class="sd">        epsilon (float): parameter for epsilon greedy policy</span>
<span class="sd">        epsilon_decay (float): step size to decrease epsilon</span>
<span class="sd">        max_epsilon (float): max value of epsilon</span>
<span class="sd">        min_epsilon (float): min value of epsilon</span>
<span class="sd">        target_update (int): period for target model&#39;s hard update</span>
<span class="sd">        gamma (float): discount factor</span>
<span class="sd">        dqn (Network): model to train and select actions</span>
<span class="sd">        dqn_target (Network): target model to update</span>
<span class="sd">        optimizer (torch.optim): optimizer for training dqn</span>
<span class="sd">        transition (list): transition information including </span>
<span class="sd">                           state, action, reward, next_state, done</span>
<span class="sd">        beta (float): determines how much importance sampling is used</span>
<span class="sd">        prior_eps (float): guarantees every transition can be sampled</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">env</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">Env</span><span class="p">,</span>
        <span class="n">memory_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">target_update</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">epsilon_decay</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">max_epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">min_epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">,</span>
        <span class="c1"># PER parameters</span>
        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
        <span class="n">prior_eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            env (gym.Env): openAI Gym environment</span>
<span class="sd">            memory_size (int): length of memory</span>
<span class="sd">            batch_size (int): batch size for sampling</span>
<span class="sd">            target_update (int): period for target model&#39;s hard update</span>
<span class="sd">            epsilon_decay (float): step size to decrease epsilon</span>
<span class="sd">            lr (float): learning rate</span>
<span class="sd">            max_epsilon (float): max value of epsilon</span>
<span class="sd">            min_epsilon (float): min value of epsilon</span>
<span class="sd">            gamma (float): discount factor</span>
<span class="sd">            alpha (float): determines how much prioritization is used</span>
<span class="sd">            beta (float): determines how much importance sampling is used</span>
<span class="sd">            prior_eps (float): guarantees every transition can be sampled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obs_dim</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">action_dim</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">n</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">max_epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_decay</span> <span class="o">=</span> <span class="n">epsilon_decay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_epsilon</span> <span class="o">=</span> <span class="n">max_epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_epsilon</span> <span class="o">=</span> <span class="n">min_epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_update</span> <span class="o">=</span> <span class="n">target_update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        
        <span class="c1"># device: cpu / gpu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span>
            <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        
        <span class="c1"># PER</span>
        <span class="c1"># In DQN, We used &quot;ReplayBuffer(obs_dim, memory_size, batch_size)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_eps</span> <span class="o">=</span> <span class="n">prior_eps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">PrioritizedReplayBuffer</span><span class="p">(</span>
            <span class="n">obs_dim</span><span class="p">,</span> <span class="n">memory_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">alpha</span>
        <span class="p">)</span>

        <span class="c1"># networks: dqn, dqn_target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dqn</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="n">obs_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dqn_target</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="n">obs_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dqn_target</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dqn</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dqn_target</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        
        <span class="c1"># optimizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dqn</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>

        <span class="c1"># transition to store in memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        
        <span class="c1"># mode: train / test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_test</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">select_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Select an action from the input state.&quot;&quot;&quot;</span>
        <span class="c1"># epsilon greedy policy</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">():</span>
            <span class="n">selected_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selected_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dqn</span><span class="p">(</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
            <span class="n">selected_action</span> <span class="o">=</span> <span class="n">selected_action</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_test</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transition</span> <span class="o">=</span> <span class="p">[</span><span class="n">state</span><span class="p">,</span> <span class="n">selected_action</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">selected_action</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Take an action and return the response of the env.&quot;&quot;&quot;</span>
        <span class="n">next_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_test</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transition</span> <span class="o">+=</span> <span class="p">[</span><span class="n">reward</span><span class="p">,</span> <span class="n">next_state</span><span class="p">,</span> <span class="n">done</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">)</span>
    
        <span class="k">return</span> <span class="n">next_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span>

    <span class="k">def</span> <span class="nf">update_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Update the model by gradient descent.&quot;&quot;&quot;</span>
        <span class="c1"># PER needs beta to calculate weights</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">sample_batch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span>
            <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;weights&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span>

        <span class="c1"># PER: importance sampling before average</span>
        <span class="n">elementwise_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_dqn_loss</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">elementwise_loss</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        
        <span class="c1"># PER: update priorities</span>
        <span class="n">loss_for_prior</span> <span class="o">=</span> <span class="n">elementwise_loss</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">new_priorities</span> <span class="o">=</span> <span class="n">loss_for_prior</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_eps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">update_priorities</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">new_priorities</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_frames</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">plotting_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Train the agent.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_test</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">update_cnt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">epsilons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">frame_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_frames</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="n">next_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

            <span class="n">state</span> <span class="o">=</span> <span class="n">next_state</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="n">reward</span>
            
            <span class="c1"># PER: increase beta</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">frame_idx</span> <span class="o">/</span> <span class="n">num_frames</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">+</span> <span class="n">fraction</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>

            <span class="c1"># if episode ends</span>
            <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
                <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
                <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># if training is ready</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_model</span><span class="p">()</span>
                <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
                <span class="n">update_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                
                <span class="c1"># linearly decrease epsilon</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">min_epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">-</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_epsilon</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_epsilon</span>
                    <span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_decay</span>
                <span class="p">)</span>
                <span class="n">epsilons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
                
                <span class="c1"># if hard update is needed</span>
                <span class="k">if</span> <span class="n">update_cnt</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_update</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_target_hard_update</span><span class="p">()</span>

            <span class="c1"># plotting</span>
            <span class="k">if</span> <span class="n">frame_idx</span> <span class="o">%</span> <span class="n">plotting_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">(</span><span class="n">frame_idx</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">losses</span><span class="p">,</span> <span class="n">epsilons</span><span class="p">)</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Test the agent.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_test</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="c1"># for recording a video</span>
        <span class="n">naive_env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">wrappers</span><span class="o">.</span><span class="n">RecordVideo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">video_folder</span><span class="o">=</span><span class="n">video_folder</span><span class="p">)</span>
        
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="n">next_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

            <span class="n">state</span> <span class="o">=</span> <span class="n">next_state</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="n">reward</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;score: &quot;</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="c1"># reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">naive_env</span>

    <span class="k">def</span> <span class="nf">_compute_dqn_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return dqn loss.&quot;&quot;&quot;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span>  <span class="c1"># for shortening the following lines</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="s2">&quot;obs&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">next_state</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="s2">&quot;next_obs&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="s2">&quot;acts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="s2">&quot;rews&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">done</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="s2">&quot;done&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># G_t   = r + gamma * v(s_{t+1})  if state != Terminal</span>
        <span class="c1">#       = r                       otherwise</span>
        <span class="n">curr_q_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dqn</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
        <span class="n">next_q_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dqn_target</span><span class="p">(</span>
            <span class="n">next_state</span>
        <span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">done</span>
        <span class="n">target</span> <span class="o">=</span> <span class="p">(</span><span class="n">reward</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">next_q_value</span> <span class="o">*</span> <span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># calculate element-wise dqn loss</span>
        <span class="n">elementwise_loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">smooth_l1_loss</span><span class="p">(</span><span class="n">curr_q_value</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">elementwise_loss</span>
    
    <span class="k">def</span> <span class="nf">_target_hard_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hard update: target &lt;- local.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dqn_target</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dqn</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span>
                
    <span class="k">def</span> <span class="nf">_plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">frame_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
        <span class="n">scores</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> 
        <span class="n">losses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> 
        <span class="n">epsilons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the training progresses.&quot;&quot;&quot;</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;frame </span><span class="si">%s</span><span class="s1">. score: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">frame_idx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:])))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;loss&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;epsilons&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epsilons</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="environment">
<h2>Environment<a class="headerlink" href="#environment" title="Permalink to this heading">#</a></h2>
<p>You can see the <a class="reference external" href="https://github.com/openai/gym/blob/master/gym/envs/classic_control/cartpole.py">code</a> and <a class="reference external" href="https://github.com/openai/gym/blob/master/gym/envs/__init__.py#L53">configurations</a> of CartPole-v0 from OpenAI’s repository.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># environment</span>
<span class="n">env_id</span> <span class="o">=</span> <span class="s2">&quot;CartPole-v0&quot;</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">env_id</span><span class="p">)</span>
<span class="k">if</span> <span class="n">IN_COLAB</span><span class="p">:</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">wrappers</span><span class="o">.</span><span class="n">Monitor</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s2">&quot;videos&quot;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-random-seed">
<h2>Set random seed<a class="headerlink" href="#set-random-seed" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seed</span> <span class="o">=</span> <span class="mi">777</span>

<span class="k">def</span> <span class="nf">seed_torch</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">deterministic</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">seed_torch</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[777]
</pre></div>
</div>
</div>
</div>
</section>
<section id="initialize">
<h2>Initialize<a class="headerlink" href="#initialize" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">num_frames</span> <span class="o">=</span> <span class="mi">20000</span>
<span class="n">memory_size</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">target_update</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">epsilon_decay</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2000</span>

<span class="c1"># train</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">DQNAgent</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">memory_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">target_update</span><span class="p">,</span> <span class="n">epsilon_decay</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cpu
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h2>Train<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agent</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_frames</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/721ae7f8abcca9226568b0f97ad8432ed290bcb6c9977fbc66c8e0b8c3441486.png" src="../_images/721ae7f8abcca9226568b0f97ad8432ed290bcb6c9977fbc66c8e0b8c3441486.png" />
</div>
</div>
</section>
<section id="test">
<h2>Test<a class="headerlink" href="#test" title="Permalink to this heading">#</a></h2>
<p>Run the trained agent (1 episode).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">video_folder</span><span class="o">=</span><span class="s2">&quot;videos/per&quot;</span>
<span class="n">agent</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">video_folder</span><span class="o">=</span><span class="n">video_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>score:  200.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="render">
<h2>Render<a class="headerlink" href="#render" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">display</span>


<span class="k">def</span> <span class="nf">ipython_show_video</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Show a video at `path` within IPython Notebook.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s2">&quot;Cannot access: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="n">video</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r+b&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">encoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>

    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;video width=&quot;320&quot; height=&quot;240&quot; alt=&quot;test&quot; controls&gt;</span>
<span class="s2">        &lt;source src=&quot;data:video/mp4;base64,</span><span class="si">{0}</span><span class="s2">&quot; type=&quot;video/mp4&quot;/&gt;</span>
<span class="s2">        &lt;/video&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">encoded</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">))</span>
    <span class="p">))</span>


<span class="k">def</span> <span class="nf">show_latest_video</span><span class="p">(</span><span class="n">video_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Show the most recently recorded video from video folder.&quot;&quot;&quot;</span>
    <span class="n">list_of_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">video_folder</span><span class="p">,</span> <span class="s2">&quot;*.mp4&quot;</span><span class="p">))</span>
    <span class="n">latest_file</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">list_of_files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getctime</span><span class="p">)</span>
    <span class="n">ipython_show_video</span><span class="p">(</span><span class="n">latest_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">latest_file</span>


<span class="n">latest_file</span> <span class="o">=</span> <span class="n">show_latest_video</span><span class="p">(</span><span class="n">video_folder</span><span class="o">=</span><span class="n">video_folder</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Played:&quot;</span><span class="p">,</span> <span class="n">latest_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <video width="320" height="240" alt="test" controls>
        <source src="data:video/mp4;base64,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AAABAAABAAAAAAEAAAUAAAAAAQAAAgAAAAABAAAAAAAAAAEAAAEAAAAAAQAABQAAAAABAAACAAAAAAEAAAAAAAAAAQAAAQAAAAABAAAFAAAAAAEAAAIAAAAAAQAAAAAAAAABAAABAAAAAAEAAAUAAAAAAQAAAgAAAAABAAAAAAAAAAEAAAEAAAAAAQAABQAAAAABAAACAAAAAAEAAAAAAAAAAQAAAQAAAAABAAAFAAAAAAEAAAIAAAAAAQAAAAAAAAABAAABAAAAAAEAAAUAAAAAAQAAAgAAAAABAAAAAAAAAAEAAAEAAAAAAQAABQAAAAABAAACAAAAAAEAAAAAAAAAAQAAAQAAAAABAAAFAAAAAAEAAAIAAAAAAQAAAAAAAAABAAABAAAAAAEAAAUAAAAAAQAAAgAAAAABAAAAAAAAAAEAAAEAAAAAAQAABQAAAAABAAACAAAAAAEAAAAAAAAAAQAAAQAAAAABAAAFAAAAAAEAAAIAAAAAAQAAAAAAAAABAAABAAAAAAEAAAUAAAAAAQAAAgAAAAABAAAAAAAAAAEAAAEAAAAAAQAABQAAAAABAAACAAAAAAEAAAAAAAAAAQAAAQAAAAABAAAFAAAAAAEAAAIAAAAAAQAAAAAAAAABAAABAAAAAAEAAAUAAAAAAQAAAgAAAAABAAAAAAAAAAEAAAEAAAAAAQAABQAAAAABAAACAAAAAAEAAAAAAAAAAQAAAQAAAAABAAAFAAAAAAEAAAIAAAAAAQAAAAAAAAABAAABAAAAAAEAAAUAAAAAAQAAAgAAAAABAAAAAAAAAAEAAAEAAAAAAQAABQAAAAABAAACAAAAAAEAAAAAAAAAAQAAAQAAAAABAAAFAAAAAAEAAAIAAAAAAQAAAAAAAAABAAABAAAAAAEAAAUAAAAAAQAAAgAAAAABAAAAAAAAAAEAAAEAAAAAAQAABQAAAAABAAACAAAAAAEAAAAAAAAAAQAAAQAAAAABAAAFAAAAAAEAAAIAAAAAAQAAAAAAAAABAAABAAAAAAEAAAUAAAAAAQAAAgAAAAABAAAAAAAAAAEAAAEAAAAAAQAABQAAAAABAAACAAAAAAEAAAAAAAAAAQAAAQAAAAABAAAFAAAAAAEAAAIAAAAAAQAAAAAAAAABAAABAAAAAAEAAAUAAAAAAQAAAgAAAAABAAAAAAAAAAEAAAEAAAAAAQAABQAAAAABAAACAAAAAAEAAAAAAAAAAQAAAQAAAAABAAAFAAAAAAEAAAIAAAAAAQAAAAAAAAABAAABAAAAAAEAAAUAAAAAAQAAAgAAAAABAAAAAAAAAAEAAAEAAAAAAQAAAgAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAMkAAAABAAADOHN0c3oAAAAAAAAAAAAAAMkAAAX+AAABywAAALEAAABjAAAAkwAAASoAAACqAAAAgAAAAGMAAADZAAAAlgAAAGsAAAB3AAABBgAAAKAAAABwAAABCAAAALwAAABvAAAAkgAAAJYAAAB+AAAAZQAAAGMAAACNAAAAgwAAAFsAAABQAAAAuQAAAIsAAABbAAAAWgAAAKkAAACPAAAATgAAAFoAAADlAAAAkwAAAGMAAABvAAABAgAAAMIAAAB2AAAAhAAAAKwAAACZAAAAXgAAAFgAAABpAAAAewAAAFIAAABZAAAAyQAAAH4AAABbAAAAWgAAAQAAAACaAAAAcAAAAJMAAADQAAAAlAAAAJgAAACAAAAAsgAAAKwAAACpAAAAbAAAAJgAAACDAAAATgAAAF4AAAB2AAAAfAAAAGQAAABpAAAAgQAAAGAAAABsAAAAVAAAAIEAAACPAAAAYQAAAG4AAACSAAAAYgAAAFkAAABqAAAAqAAAAIIAAABWAAAAYwAAAK8AAADSAAAAaQAAAE4AAACGAAAAlgAAAFQAAABcAAAAjQAAAHcAAABYAAAASgAAAJgAAAByAAAARAAAAEwAAAC3AAAAiQAAAEMAAABWAAAAfgAAAIIAAABSAAAAPQAAAMgAAABaAAAAVQAAADsAAAC0AAAAYQAAAEoAAAA/AAAAXgAAAGgAAABJAAAAPgAAAGAAAABVAAAAOgAAAD4AAACAAAAAmQAAAFAAAABFAAAAVgAAAIoAAAA7AAAASwAAAGkAAABSAAAAOQAAAEUAAACcAAAAWAAAADcAAAA/AAAAiQAAAGwAAABPAAAATgAAAIcAAAB5AAAAVQAAADgAAABVAAAASwAAADUAAAA0AAAAQgAAAEcAAAA1AAAAOgAAAEMAAABIAAAANQAAADgAAAB6AAAAVAAAADcAAABGAAAAVQAAAFwAAABIAAAAQAAAAE4AAABaAAAAQQAAAD4AAABJAAAARwAAADYAAABFAAAAagAAAEsAAAA1AAAAOwAAAF4AAABUAAAAQgAAADMAAAAxAAAAYwAAADkAAAA1AAAAbwAAAGQAAABFAAAARAAAAEkAAAAUc3RjbwAAAAAAAAABAAAAMAAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTguNzYuMTAw" type="video/mp4"/>
        </video>
        </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Played: videos/per/rl-video-episode-0.mp4
</pre></div>
</div>
</div>
</div>
</section>
</section>

<div class="section">
   
</div>

            
            
        </article>
        
        
        
        <footer class="bd-footer-article">
            
            <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="double_q.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">02. Double DQN</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="dueling.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">04. Dueling Network</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
            
        </footer>
        
    </div>
    
    
    
    <div class="bd-sidebar-secondary bd-toc">
        
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fas fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#replay-buffer">
   Replay buffer
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prioritized-replay-buffer">
   Prioritized replay Buffer
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#network">
   Network
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dqn-per-agent">
   DQN + PER Agent
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#init">
     <strong>
      init
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-dqn-loss-update-model">
     compute_dqn_loss &amp; update_model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train">
     train
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#environment">
   Environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-random-seed">
   Set random seed
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initialize">
   Initialize
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Train
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test">
   Test
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#render">
   Render
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  

<div class="tocsection editthispage">
    <a href="https://github.com/zclab/notebook/edit/main/docs/reinforcement/per.ipynb">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/reinforcement/per.ipynb.txt">
        <i class="fas fa-file-alt"></i> Show Source
    </a>
</div>

</div>

    </div>
    
    
</div>
<footer class="bd-footer-content">
    <div class="bd-footer-content__inner">
        
    </div>
</footer>

      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">
    
    
    <img src="https://img.shields.io/badge/Copyright-2021--2022 子川-blue" />
    <br>
    
</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
    
    <a href="http://sphinx-doc.org/" target="_blank">
        <img src="https://img.shields.io/badge/Sphinx-5.2.2-blue" />
    </a>
    <a href="https://pydata-sphinx-theme.readthedocs.io/en/latest/" target="_blank">
        <img src="https://img.shields.io/badge/Theme-Pydata%20Sphinx%20Theme-blue" />
    </a>
    <br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>